<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Local LLM Chat Advanced v2.0</title>
  <link rel="stylesheet" href="assets/app.css" />
  <link rel="stylesheet" href="assets/katex.min.css" />
</head>
<body>
  <svg class="icon-sprite" aria-hidden="true" focusable="false">
    <symbol id="i-send" viewBox="0 0 24 24"><path d="M3 11.5 21 3l-6.5 18-2.8-6.7L3 11.5Z" fill="currentColor"/><path d="M21 3 11.7 14.3" stroke="currentColor" stroke-width="1.6" fill="none"/></symbol>
    <symbol id="i-stop" viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12" rx="2.3" fill="currentColor"/></symbol>
    <symbol id="i-attach" viewBox="0 0 24 24"><path d="M8 12.5v4.1a4 4 0 0 0 8 0V8.2a2.7 2.7 0 1 0-5.4 0v8a1.4 1.4 0 1 0 2.8 0v-6.7" stroke="currentColor" stroke-width="1.8" fill="none" stroke-linecap="round"/></symbol>
    <symbol id="i-refresh" viewBox="0 0 24 24"><path d="M20 12a8 8 0 1 1-2.3-5.7" stroke="currentColor" stroke-width="1.8" fill="none"/><path d="M20 5v5h-5" stroke="currentColor" stroke-width="1.8" fill="none"/></symbol>
    <symbol id="i-plus" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="1.8" fill="none" stroke-linecap="round"/></symbol>
    <symbol id="i-settings" viewBox="0 0 24 24"><path d="M12 9.1a2.9 2.9 0 1 0 0 5.8 2.9 2.9 0 0 0 0-5.8Z" fill="currentColor"/><path d="m19.4 13.2.1-2.4-2.2-.6a5.9 5.9 0 0 0-.6-1.4l1.1-2-1.7-1.7-2 1a5.7 5.7 0 0 0-1.4-.6l-.6-2.2h-2.4l-.6 2.2a5.9 5.9 0 0 0-1.4.6l-2-1L4 6.8l1 2a5.9 5.9 0 0 0-.6 1.4l-2.2.6.1 2.4 2.2.6a5.9 5.9 0 0 0 .6 1.4L4 17.2 5.7 19l2-1.1a5.9 5.9 0 0 0 1.4.6l.6 2.2h2.4l.6-2.2a5.9 5.9 0 0 0 1.4-.6l2 1.1 1.7-1.7-1.1-2a5.9 5.9 0 0 0 .6-1.4l2.2-.7Z" stroke="currentColor" stroke-width="1.1" fill="none"/></symbol>
    <symbol id="i-trash" viewBox="0 0 24 24"><path d="M5 7h14M9 7V5h6v2m-8 0 1 12h8l1-12" stroke="currentColor" stroke-width="1.7" fill="none" stroke-linecap="round"/></symbol>
    <symbol id="i-repeat" viewBox="0 0 24 24"><path d="M17 2v4h-4M7 22v-4h4M20 11a6 6 0 0 0-10.2-4.2L7 10M4 13a6 6 0 0 0 10.2 4.2L17 14" stroke="currentColor" stroke-width="1.7" fill="none" stroke-linecap="round"/></symbol>
    <symbol id="i-edit" viewBox="0 0 24 24"><path d="m5 19 4.6-1 9.1-9.1a1.7 1.7 0 0 0 0-2.5l-1.1-1.1a1.7 1.7 0 0 0-2.5 0L6 14.4 5 19Z" stroke="currentColor" stroke-width="1.6" fill="none"/><path d="M13.8 6.2 17.8 10.2" stroke="currentColor" stroke-width="1.6"/></symbol>
    <symbol id="i-close" viewBox="0 0 24 24"><path d="m6 6 12 12M18 6 6 18" stroke="currentColor" stroke-width="1.8" fill="none" stroke-linecap="round"/></symbol>
    <symbol id="i-spark" viewBox="0 0 24 24"><path d="m12 3 1.8 4.3L18 9l-4.2 1.7L12 15l-1.8-4.3L6 9l4.2-1.7L12 3Z" fill="currentColor"/><path d="m5 16 1 2.4L8.4 19 6 20l-1 2.4L4 20l-2.4-1L4 18.4 5 16Zm14 1 1 2.4L22.4 20 20 21l-1 2.4-1-2.4L15.6 20l2.4-1 .9-2Z" fill="currentColor"/></symbol>
    <symbol id="i-help" viewBox="0 0 24 24"><path d="M12 18h.01M9.3 9.2a2.7 2.7 0 1 1 4.4 2.1c-.9.7-1.7 1.2-1.7 2.2v.5" stroke="currentColor" stroke-width="1.8" fill="none" stroke-linecap="round"/><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5" fill="none"/></symbol>
    <symbol id="i-keyboard" viewBox="0 0 24 24"><rect x="3" y="6" width="18" height="12" rx="2.4" stroke="currentColor" stroke-width="1.6" fill="none"/><path d="M6 10h.01M9 10h.01M12 10h.01M15 10h.01M18 10h.01M7 14h10" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></symbol>
    <symbol id="i-style" viewBox="0 0 24 24"><path d="M6 6h12M9 12h6M7 18h10" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></symbol>
    <symbol id="i-user" viewBox="0 0 24 24"><circle cx="12" cy="8" r="3.4" stroke="currentColor" stroke-width="1.6" fill="none"/><path d="M5 19a7 7 0 0 1 14 0" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"/></symbol>
    <symbol id="i-logprobs" viewBox="0 0 24 24"><path d="M4 18h16M7 16V9m5 7V6m5 10v-4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></symbol>
    <symbol id="i-preset" viewBox="0 0 24 24"><path d="M6 4h12a2 2 0 0 1 2 2v14l-8-4-8 4V6a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="1.6" fill="none"/></symbol>
    <symbol id="i-export" viewBox="0 0 24 24"><path d="M12 3v12m0-12 4 4m-4-4-4 4M5 14v5h14v-5" stroke="currentColor" stroke-width="1.8" fill="none" stroke-linecap="round"/></symbol>
    <symbol id="i-import" viewBox="0 0 24 24"><path d="M12 21V9m0 12 4-4m-4 4-4-4M5 10V5h14v5" stroke="currentColor" stroke-width="1.8" fill="none" stroke-linecap="round"/></symbol>
    <symbol id="i-copy" viewBox="0 0 24 24"><path d="M8 4v12h12V4H8Z" stroke="currentColor" stroke-width="1.6" fill="none"/><path d="M4 8v12h12" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"/></symbol>
    <symbol id="i-compare" viewBox="0 0 24 24"><path d="M4 6h7v12H4zM13 6h7v12h-7zM11 12h2" stroke="currentColor" stroke-width="1.6" fill="none"/></symbol>
    <symbol id="i-termcheck" viewBox="0 0 24 24"><path d="M4 5h16v14H4zM8 9h8M8 13h5M14 16l1.8 1.8L20 13.6" stroke="currentColor" stroke-width="1.7" fill="none" stroke-linecap="round"/></symbol>
    <symbol id="i-history" viewBox="0 0 24 24"><path d="M6 5h12a2 2 0 0 1 2 2v12H8a2 2 0 0 1-2-2V5Zm0 0v12a2 2 0 0 0 2 2H4V7a2 2 0 0 1 2-2Zm4 4h6m-6 4h6m-6 4h4" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"/></symbol>
    <symbol id="i-search" viewBox="0 0 24 24"><circle cx="10.5" cy="10.5" r="6" stroke="currentColor" stroke-width="1.7" fill="none"/><path d="m15 15 5 5" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/></symbol>
    <symbol id="i-arrow-down" viewBox="0 0 24 24"><path d="M12 5v14m0 0-5-5m5 5 5-5" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></symbol>
    <symbol id="i-markdown" viewBox="0 0 24 24"><path d="M3 5h18v14H3V5Zm3 10V9l3 3.5L12 9v6m4-6v6m0 0 2.5-3m-2.5 3-2.5-3" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></symbol>
    <symbol id="i-newchat" viewBox="0 0 24 24"><path d="M4 6a2 2 0 0 1 2-2h8l6 6v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6Zm6 5h4m-2-2v4" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"/></symbol>
    <symbol id="i-globe" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.6" fill="none"/><path d="M3 12h18M12 3c-2.5 3-4 6-4 9s1.5 6 4 9c2.5-3 4-6 4-9s-1.5-6-4-9Z" stroke="currentColor" stroke-width="1.5" fill="none"/></symbol>
    <symbol id="i-star" viewBox="0 0 24 24"><path d="M12 2l2.9 6.3L22 9.2l-5 4.6L18.2 21 12 17.3 5.8 21 7 13.8 2 9.2l7.1-.9L12 2Z" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linejoin="round"/></symbol>
    <symbol id="i-star-filled" viewBox="0 0 24 24"><path d="M12 2l2.9 6.3L22 9.2l-5 4.6L18.2 21 12 17.3 5.8 21 7 13.8 2 9.2l7.1-.9L12 2Z" fill="currentColor" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/></symbol>
    <symbol id="i-speaker" viewBox="0 0 24 24"><path d="M11 5 6 9H2v6h4l5 4V5Z" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linejoin="round"/><path d="M15.5 8.5a4 4 0 0 1 0 7M18.5 5.5a8 8 0 0 1 0 13" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"/></symbol>
    <symbol id="i-speaker-off" viewBox="0 0 24 24"><path d="M11 5 6 9H2v6h4l5 4V5Z" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linejoin="round"/><path d="M16 9l6 6m0-6-6 6" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"/></symbol>
  </svg>
  <div class="app-shell">
    <header class="toolbar">
      <div class="toolbar-left">
        <div class="logo">LLM</div>
        <div class="brand-block">
          <h1 class="brand-title">Local LLM Chat Advanced</h1>
          <p class="brand-subtitle"></p>
        </div>
        <span class="brand-pill">LM Studio</span>
      </div>
      <div class="toolbar-right">
        <select id="modelSelect" aria-label="モデル選択">
          <option value="">モデルを選択</option>
        </select>
        <span id="modelLoadStatus" class="model-load-status" role="status" aria-live="polite" hidden></span>
        <button id="refreshModelsBtn" class="btn ghost icon-btn icon-only" data-tooltip="モデル更新" aria-label="モデル更新"><svg class="icon"><use href="#i-refresh"></use></svg></button>
        <button id="compareModeBtn" class="btn ghost icon-btn icon-only mode-btn" data-tooltip="比較モード" aria-label="比較モード"><svg class="icon"><use href="#i-compare"></use></svg></button>
        <button id="newChatBtn" class="btn ghost icon-btn icon-only" data-tooltip="新規チャット" aria-label="新規チャット"><svg class="icon"><use href="#i-newchat"></use></svg></button>
        <button id="newTopicBtn" class="btn ghost icon-btn icon-only" data-tooltip="新しい話題" aria-label="新しい話題"><svg class="icon"><use href="#i-plus"></use></svg></button>
        <button id="searchBtn" class="btn ghost icon-btn icon-only" data-tooltip="検索" aria-label="検索"><svg class="icon"><use href="#i-search"></use></svg></button>
        <button id="sessionLogsBtn" class="btn ghost icon-btn icon-only" data-tooltip="会話ログ" aria-label="会話ログ"><svg class="icon"><use href="#i-history"></use></svg></button>
        <button id="settingsBtn" class="btn ghost icon-btn icon-only" data-tooltip="設定" aria-label="設定"><svg class="icon"><use href="#i-settings"></use></svg></button>
      </div>
    </header>
    <div id="searchBar" class="search-bar" hidden>
      <svg class="icon" style="flex:0 0 16px;color:var(--color-neutral-400)"><use href="#i-search"></use></svg>
      <input id="searchInput" type="text" placeholder="メッセージを検索..." />
      <span id="searchCount" class="search-count"></span>
      <button id="searchCloseBtn" class="btn ghost icon-btn icon-only" data-tooltip="閉じる" aria-label="閉じる"><svg class="icon"><use href="#i-close"></use></svg></button>
    </div>
    <section id="compareControls" class="compare-controls" hidden>
      <label>Model A
        <select id="compareModelASelect"></select>
      </label>
      <label>Model B
        <select id="compareModelBSelect"></select>
      </label>
    </section>

    <main id="chatMain" class="chat-main">
      <section id="chatContainer" class="chat-container" aria-live="polite"></section>
    </main>
    <button id="scrollBottomBtn" class="scroll-bottom-btn" hidden aria-label="最下部へスクロール">
      <svg class="icon"><use href="#i-arrow-down"></use></svg>
      <span id="scrollBottomBadge" class="scroll-bottom-badge" hidden></span>
    </button>

    <footer class="input-wrap">
      <div id="attachmentList" class="attachment-list"></div>
      <div class="input-subactions">
        <button id="presetBtn" class="btn ghost icon-btn icon-only mode-btn" data-tooltip="プリセット" aria-label="プリセット"><svg class="icon"><use href="#i-preset"></use></svg></button>
        <button id="deepDiveBtn" class="btn ghost icon-btn icon-only mode-btn" data-tooltip="深掘りモード" aria-label="深掘りモード"><svg class="icon"><use href="#i-spark"></use></svg></button>
        <button id="helpModeBtn" class="btn ghost icon-btn icon-only mode-btn" data-tooltip="ヘルプモード" aria-label="ヘルプモード"><svg class="icon"><use href="#i-help"></use></svg></button>
        <button id="webSearchBtn" class="btn ghost icon-btn icon-only mode-btn" data-tooltip="Web検索 (SearXNG)" aria-label="Web検索"><svg class="icon"><use href="#i-globe"></use></svg></button>
        <button id="ttsAutoBtn" class="btn ghost icon-btn icon-only mode-btn" data-tooltip="自動読み上げ" aria-label="自動読み上げ"><svg class="icon"><use href="#i-speaker"></use></svg></button>
      </div>
      <div id="presetPopover" class="preset-popover" hidden>
        <div id="presetList" class="preset-list"></div>
        <button id="openPresetManagerBtn" class="btn ghost preset-manage-btn">プリセット管理を開く</button>
      </div>
      <div class="input-card">
        <label class="attach-btn icon-btn icon-only" for="fileInput" data-tooltip="添付" aria-label="添付"><svg class="icon"><use href="#i-attach"></use></svg></label>
        <input id="fileInput" type="file" multiple hidden />
        <textarea id="messageInput" rows="1" placeholder="メッセージを入力"></textarea>
        <button id="stopBtn" class="btn danger icon-btn icon-only" data-tooltip="停止" aria-label="停止" disabled><svg class="icon"><use href="#i-stop"></use></svg></button>
        <button id="sendBtn" class="btn primary icon-btn icon-only" data-tooltip="送信" aria-label="送信"><svg class="icon"><use href="#i-send"></use></svg></button>
      </div>
      <div class="input-hint-row">
        <p id="sendKeyHint" class="muted">Enter改行 / Shift+Enter送信</p>
        <span id="tokenEstimate" class="token-estimate"></span>
      </div>
    </footer>
  </div>

  <aside id="settingsPanel" class="settings-panel" aria-hidden="true">
    <div class="settings-header">
      <h2>設定</h2>
      <button id="closeSettingsBtn" class="btn ghost icon-btn icon-only" data-tooltip="閉じる" aria-label="閉じる"><svg class="icon"><use href="#i-close"></use></svg></button>
    </div>
    <div class="settings-content">
      <div class="settings-tabs" role="tablist" aria-label="設定タブ">
        <button id="settingsTabBasic" class="settings-tab is-active" type="button" role="tab" aria-selected="true">基本</button>
        <button id="settingsTabPresets" class="settings-tab" type="button" role="tab" aria-selected="false">プリセット</button>
        <button id="settingsTabData" class="settings-tab" type="button" role="tab" aria-selected="false">データ</button>
        <button id="settingsTabWebSearch" class="settings-tab" type="button" role="tab" aria-selected="false">Web検索</button>
        <button id="settingsTabVoice" class="settings-tab" type="button" role="tab" aria-selected="false">音声応答</button>
      </div>

      <div id="settingsPanelBasic" class="settings-tab-panel">
        <div class="settings-section">
          <p class="settings-section-title"><svg class="icon"><use href="#i-keyboard"></use></svg><span>入力</span></p>
          <label>送信キー
            <select id="sendKeySelect">
              <option value="shift-enter-send">Enterで改行 / Shift+Enterで送信</option>
              <option value="enter-send">Enterで送信 / Shift+Enterで改行</option>
            </select>
          </label>
          <label class="row-toggle"><input id="autoGreetingOnNewTopicInput" type="checkbox" />新規チャットでLLMから呼びかけ</label>
          <label class="row-toggle"><input id="memoryEnabledInput" type="checkbox" />メモリー機能</label>
          <label class="row-toggle"><input id="darkModeInput" type="checkbox" />ダークモード</label>
          <label class="row-toggle"><input id="autoUnloadInput" type="checkbox" />モデル自動アンロード</label>
          <label class="row-toggle"><input id="autoTitleInput" type="checkbox" />タイトル自動生成</label>
        </div>

        <div class="settings-section">
          <p class="settings-section-title"><svg class="icon"><use href="#i-style"></use></svg><span>応答スタイル</span></p>
          <label>Response Style
            <select id="responseStyleSelect">
              <option value="concise">concise</option>
              <option value="standard">standard</option>
              <option value="detailed">detailed</option>
              <option value="professional">professional</option>
            </select>
          </label>
        </div>

        <div class="settings-section">
          <p class="settings-section-title"><svg class="icon"><use href="#i-user"></use></svg><span>ユーザープロファイル</span></p>
          <label>レベル
            <select id="userLevelSelect">
              <option value="">未設定</option>
              <option value="beginner">beginner</option>
              <option value="intermediate">intermediate</option>
              <option value="advanced">advanced</option>
              <option value="expert">expert</option>
            </select>
          </label>
          <label>職業 / 専門分野
            <input id="userProfessionInput" type="text" />
          </label>
          <label>興味・関心
            <input id="userInterestsInput" type="text" />
          </label>
          <label>呼び名
            <input id="userDisplayNameInput" type="text" placeholder="例: まさとさん" />
          </label>
        </div>

        <div class="settings-section">
          <p class="settings-section-title"><svg class="icon"><use href="#i-logprobs"></use></svg><span>詳細モード</span></p>
          <label class="row-toggle"><input id="showLogprobsInput" type="checkbox" />信頼度・代替候補（logprobs）表示</label>
          <label class="row-toggle"><input id="hideThinkingInput" type="checkbox" />思考プロセスを非表示</label>
        </div>

        <div class="settings-section">
          <p class="settings-section-title"><svg class="icon"><use href="#i-settings"></use></svg><span>接続</span></p>
          <label>Base URL
            <input id="baseUrlInput" type="text" />
          </label>
          <label>API Key
            <input id="apiKeyInput" type="text" />
          </label>
          <label>Temperature
            <div class="range-row">
              <input id="temperatureInput" type="range" min="0" max="2" step="0.1" />
              <span id="tempValue" class="range-value">0.7</span>
            </div>
          </label>
          <label>Max Tokens
            <input id="maxTokensInput" type="number" min="1" max="8192" step="1" />
          </label>
          <label>Reasoning Effort
            <select id="reasoningEffortSelect">
              <option value="">off</option>
              <option value="low">low</option>
              <option value="medium">medium</option>
              <option value="high">high</option>
            </select>
          </label>
        </div>

      </div>

      <div id="settingsPanelPresets" class="settings-tab-panel" hidden>
        <div class="settings-section">
          <p class="settings-section-title"><svg class="icon"><use href="#i-style"></use></svg><span>System Prompt</span></p>
          <label>System Prompt
            <textarea id="systemPromptInput" rows="6"></textarea>
          </label>
          <label>プリセット選択
            <select id="systemPromptPresetSelect"></select>
          </label>
          <label>新規保存名
            <input id="systemPromptPresetNameInput" type="text" placeholder="例: 研究モード" />
          </label>
          <div class="settings-actions">
            <button id="systemPromptApplyBtn" class="btn ghost">適用</button>
            <button id="systemPromptSaveBtn" class="btn primary">保存</button>
            <button id="systemPromptDeleteBtn" class="btn danger">削除</button>
          </div>
        </div>

        <div class="settings-section">
          <p class="settings-section-title"><svg class="icon"><use href="#i-preset"></use></svg><span>プリセット管理</span></p>
          <label>プリセット選択
            <select id="presetManageSelect"></select>
          </label>
          <label>キー
            <input id="presetManageKeyInput" type="text" placeholder="例: disease" />
          </label>
          <label>表示名
            <input id="presetManageLabelInput" type="text" />
          </label>
          <label>内容
            <textarea id="presetManageContentInput" rows="4"></textarea>
          </label>
          <div class="settings-actions">
            <button id="presetManageNewBtn" class="btn ghost">新規追加</button>
            <button id="presetManageSaveBtn" class="btn primary">保存</button>
            <button id="presetManageDeleteBtn" class="btn danger">削除</button>
            <button id="presetManageResetBtn" class="btn ghost">デフォルト復元</button>
          </div>
        </div>

      </div>

      <div id="settingsPanelData" class="settings-tab-panel" hidden>
        <div class="settings-section">
          <p class="settings-section-title"><svg class="icon"><use href="#i-settings"></use></svg><span>リセット</span></p>
          <div class="settings-actions">
            <button id="resetSettingsBtn" class="btn ghost">設定をデフォルトに戻す</button>
            <button id="clearAllDataBtn" class="btn danger">すべての保存データを消す</button>
          </div>
        </div>

        <div class="settings-section">
          <p class="settings-section-title"><svg class="icon"><use href="#i-user"></use></svg><span>メモリー管理</span></p>
          <p id="memoryCount" class="muted">保存メモリー: 0件</p>
          <div class="settings-actions">
            <button id="clearMemoriesBtn" class="btn ghost">メモリー全削除</button>
          </div>
          <div id="memoryList" class="memory-list"></div>
        </div>

        <div class="settings-section">
          <p class="settings-section-title"><svg class="icon"><use href="#i-settings"></use></svg><span>表示モデル管理</span></p>
          <p id="modelVisibilityCount" class="muted">表示対象: 0 / 0</p>
          <div class="settings-actions">
            <button id="modelVisibilitySelectAllBtn" class="btn ghost">すべて表示</button>
            <button id="modelVisibilityClearBtn" class="btn ghost">すべて非表示</button>
          </div>
          <div id="modelVisibilityList" class="model-visibility-list"></div>
        </div>

        <div class="settings-section">
          <p class="settings-section-title"><svg class="icon"><use href="#i-history"></use></svg><span>会話ログ管理</span></p>
          <p id="sessionCount" class="muted">保存ログ: 0件</p>
          <div class="settings-actions">
            <button id="createSessionBtn" class="btn ghost icon-btn"><svg class="icon"><use href="#i-plus"></use></svg><span>新規チャットを作成</span></button>
            <button id="exportHistoryBtn" class="btn ghost icon-btn"><svg class="icon"><use href="#i-export"></use></svg><span>ログエクスポート</span></button>
            <button id="exportMarkdownBtn" class="btn ghost icon-btn"><svg class="icon"><use href="#i-markdown"></use></svg><span>Markdown出力</span></button>
            <button id="importBtn" class="btn ghost icon-btn"><svg class="icon"><use href="#i-import"></use></svg><span>ログインポート</span></button>
          </div>
          <div id="sessionList" class="session-list"></div>
        </div>
      </div>

      <div id="settingsPanelWebSearch" class="settings-tab-panel" hidden>
        <div class="settings-section">
          <p class="settings-section-title"><svg class="icon"><use href="#i-globe"></use></svg><span>Web検索 (SearXNG)</span></p>
          <label class="row-toggle"><input id="webSearchEnabledInput" type="checkbox" />Web検索を有効にする</label>
          <label>SearXNG URL
            <input id="webSearchUrlInput" type="text" placeholder="http://localhost:8888" />
          </label>
          <label>検索結果数
            <input id="webSearchResultsInput" type="number" min="1" max="10" step="1" />
          </label>
          <label>検索カテゴリ
            <select id="webSearchCategoriesSelect">
              <option value="general">general（一般Web検索）</option>
              <option value="science">science（学術論文）</option>
              <option value="news">news（ニュース）</option>
              <option value="it">it（IT・技術）</option>
              <option value="files">files（ファイル検索）</option>
              <option value="images">images（画像検索）</option>
              <option value="videos">videos（動画検索）</option>
            </select>
          </label>
        </div>
      </div>

      <div id="settingsPanelVoice" class="settings-tab-panel" hidden>
        <div class="settings-section">
          <p class="settings-section-title"><svg class="icon"><use href="#i-speaker"></use></svg><span>基本設定</span></p>
          <label class="row-toggle"><input id="ttsEnabledInput" type="checkbox" />音声読み上げを有効にする</label>
          <label class="row-toggle"><input id="ttsAutoReadInput" type="checkbox" />新しい応答を自動読み上げ</label>
          <label class="row-toggle"><input id="ttsSummarizeInput" type="checkbox" />LLMで音声用に要約してから読み上げ</label>
        </div>
        <div class="settings-section">
          <p class="settings-section-title"><svg class="icon"><use href="#i-settings"></use></svg><span>TTSバックエンド</span></p>
          <label>バックエンド選択
            <select id="ttsBackendSelect">
              <option value="browser">ブラウザ (Web Speech API)</option>
              <option value="qwen3">Qwen3-TTS (ローカルサーバ)</option>
            </select>
          </label>
          <div id="browserTtsOptions">
            <label>音声
              <select id="ttsVoiceSelect"></select>
            </label>
            <label>読み上げ速度
              <div class="range-row">
                <input id="ttsRateInput" type="range" min="0.5" max="2" step="0.1" />
                <span id="ttsRateValue" class="range-value">1.0</span>
              </div>
            </label>
          </div>
          <div id="qwen3TtsOptions" hidden>
            <label>サーバURL
              <input id="qwen3TtsUrlInput" type="text" placeholder="http://localhost:8520" />
            </label>
            <label>話者
              <select id="qwen3TtsSpeakerSelect">
                <option value="ono_anna">Ono Anna (日本語女性)</option>
                <option value="aiden">Aiden (英語男性)</option>
                <option value="dylan">Dylan (英語男性)</option>
                <option value="eric">Eric (英語男性)</option>
                <option value="ryan">Ryan (英語男性)</option>
                <option value="serena">Serena (英語女性)</option>
                <option value="sohee">Sohee (韓国語女性)</option>
                <option value="uncle_fu">Uncle Fu (中国語男性)</option>
                <option value="vivian">Vivian (中国語女性)</option>
              </select>
            </label>
            <div id="qwen3TtsStatus" style="font-size:0.85em;padding:4px 0;color:var(--text-secondary)">未接続</div>
          </div>
        </div>
      </div>

    </div>
  </aside>
  <div id="overlay" class="overlay" hidden></div>

  <input id="imageInput" type="file" accept="image/*" multiple hidden />
  <input id="importInput" type="file" accept=".json" hidden />

  <div id="termCheckModal" class="modal-overlay" hidden>
    <div class="modal">
      <div class="modal__header">
        <h3>医学用語チェック結果</h3>
        <button id="termCheckCloseBtn" class="btn ghost icon-btn icon-only" data-tooltip="閉じる" aria-label="閉じる"><svg class="icon"><use href="#i-close"></use></svg></button>
      </div>
      <div id="termCheckContent" class="modal__body"></div>
    </div>
  </div>

  <div id="shortcutsModal" class="modal-overlay" hidden>
    <div class="modal">
      <div class="modal__header">
        <h3>キーボードショートカット</h3>
        <button id="shortcutsCloseBtn" class="btn ghost icon-btn icon-only" data-tooltip="閉じる" aria-label="閉じる"><svg class="icon"><use href="#i-close"></use></svg></button>
      </div>
      <div class="modal__body">
        <table class="shortcuts-table">
          <tr><td><kbd>⌘/Ctrl</kbd> + <kbd>K</kbd></td><td>新規チャット</td></tr>
          <tr><td><kbd>⌘/Ctrl</kbd> + <kbd>F</kbd></td><td>会話検索</td></tr>
          <tr><td><kbd>⌘/Ctrl</kbd> + <kbd>/</kbd></td><td>ショートカット一覧</td></tr>
          <tr><td><kbd>⌘/Ctrl</kbd> + <kbd>,</kbd></td><td>設定を開く</td></tr>
          <tr><td><kbd>⌘/Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>D</kbd></td><td>ダークモード切替</td></tr>
          <tr><td><kbd>⌘/Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>C</kbd></td><td>比較モード切替</td></tr>
          <tr><td><kbd>⌘/Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>W</kbd></td><td>Web検索切替</td></tr>
          <tr><td><kbd>⌘/Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>B</kbd></td><td>ブックマーク一覧</td></tr>
          <tr><td><kbd>⌘/Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>T</kbd></td><td>自動読み上げ切替</td></tr>
          <tr><td><kbd>Esc</kbd></td><td>パネル・検索を閉じる</td></tr>
        </table>
      </div>
    </div>
  </div>

  <div id="bookmarkModal" class="modal-overlay" hidden>
    <div class="modal">
      <div class="modal__header">
        <h3>ブックマーク一覧</h3>
        <button id="bookmarkCloseBtn" class="btn ghost icon-btn icon-only" data-tooltip="閉じる" aria-label="閉じる"><svg class="icon"><use href="#i-close"></use></svg></button>
      </div>
      <div id="bookmarkContent" class="modal__body"></div>
    </div>
  </div>

  <div class="app-version">v2.0</div>
  <script src="assets/katex.min.js"></script>
  <script src="assets/pdf.min.js"></script>
  <script src="js/manual-content.js"></script>
  <script src="js/app.js?v=2.7"></script>
</body>
</html>
