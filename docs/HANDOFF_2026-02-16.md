# Handoff Note - Local LLM Chat Advanced v1.0 (2026-02-16 00:59 JST)

## 目的
次回の開発を中断点から再開できるように、実装済み内容と次アクションを記録。

## 対象
- アプリ名: `Local LLM Chat Advanced`
- バージョン: `v1.0`

## 今日までの実装サマリ
1. 比較モード状態管理の不整合を修正
- 比較ON/OFFの単一状態化（見た目と送信ロジックを一致）
- 比較OFF時に右カラムエラーが出る問題を修正

2. 送信時の重複応答対策
- APIメッセージ組み立てで同一ユーザー入力の二重投入を防止

3. 設定保存の改善
- 設定は変更時に自動保存（保存ボタン不要）
- 設定下部の `保存` / `全データ削除` ボタンを削除

4. 送信キー仕様変更
- デフォルト: `Enterで改行 / Shift+Enterで送信`
- 逆設定: `Enterで送信 / Shift+Enterで改行`
- 旧設定値の移行ロジックを追加

5. 設定UIの再編
- 設定タブを `基本` / `プリセット` / `データ` に分割
- `ダークモード` と `モデル自動アンロード` を上部へ移動
- `System Prompt` 関連を1か所に統合
- `深掘りモード` / `ヘルプモード` の設定内チェックボックスは削除（下部モードボタンで操作）

6. プリセット管理の拡張
- `新規追加` ボタンを追加
- `＋ 新規プリセット` 選択肢を追加

7. ヘルプモードの強化
- ヘルプON時、操作手順優先の指示を入力に自動付与
- ヒント表示に `ヘルプモード` / `深掘りモード` 状態を表示

8. マニュアル整備
- `docs/MANUAL.md` を画面ラベル一致版に更新
- `docs/MANUAL.md` から `js/manual-content.js` を生成する仕組みを追加
  - 生成スクリプト: `scripts/sync-manual-embed.mjs`
  - 読み込み順: `index.html` で `js/manual-content.js` → `js/app.js`

9. Enter誤送信対策
- IME変換中の `Enter` で送信されないようガード追加
  - `compositionstart` / `compositionend` / `e.isComposing` / `keyCode===229`

## 主な更新ファイル
- `/Users/m4_max/Desktop/wada_work/local_llm_chat_v2/index.html`
- `/Users/m4_max/Desktop/wada_work/local_llm_chat_v2/js/app.js`
- `/Users/m4_max/Desktop/wada_work/local_llm_chat_v2/assets/app.css`
- `/Users/m4_max/Desktop/wada_work/local_llm_chat_v2/docs/MANUAL.md`
- `/Users/m4_max/Desktop/wada_work/local_llm_chat_v2/js/manual-content.js` (生成物)
- `/Users/m4_max/Desktop/wada_work/local_llm_chat_v2/scripts/sync-manual-embed.mjs`

## 再開時の最初の手順
1. マニュアル更新がある場合のみ:
`node scripts/sync-manual-embed.mjs`
2. ブラウザでハードリロードしてUI反映確認
3. 以下の回帰確認を実施:
- 比較ON/OFFで表示と送信挙動が一致する
- 送信キー挙動が設定どおり
- IME変換中Enterで誤送信しない
- `プリセット管理を開く` で `プリセット` タブが開く

## 次回の優先候補
1. ヘルプモード回答の精度評価（実際の質問セットで10ケース）
2. MANUAL更新と `APP_MANUAL_CONTENT` の自動同期を開発フローに固定
3. 必要なら「設定の一括リセット」機能を別導線で再導入（現在は削除済み）
