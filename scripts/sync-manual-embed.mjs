#!/usr/bin/env node
import { readFileSync, writeFileSync, mkdirSync } from "node:fs";
import { dirname, resolve } from "node:path";
import { fileURLToPath } from "node:url";

const __dirname = dirname(fileURLToPath(import.meta.url));
const rootDir = resolve(__dirname, "..");
const manualPath = resolve(rootDir, "docs", "MANUAL.md");
const outputPath = resolve(rootDir, "js", "manual-content.js");

function escapeTemplateLiteral(text) {
  return text.replace(/\\/g, "\\\\").replace(/`/g, "\\`").replace(/\$\{/g, "\\${");
}

const manual = readFileSync(manualPath, "utf8").trim();
const escaped = escapeTemplateLiteral(manual);
const output = `// Auto-generated by scripts/sync-manual-embed.mjs
// Source: docs/MANUAL.md
window.APP_MANUAL_CONTENT = \`${escaped}\`;
`;

mkdirSync(dirname(outputPath), { recursive: true });
writeFileSync(outputPath, output, "utf8");
console.log(`Generated: ${outputPath}`);
